INSERT INTO review (id, rating, text, user_id, product_id) VALUES 
    ('c1a2b3d4-e5f6-4789-9123-456789abcd12', 1, 'Отличный смартфон, работает быстро!', 'a5d3f7b2-6e8c-4c1a-9d72-bf4e39a8c6e1', '550e8400-e29b-41d4-a716-446655440013'),
    ('d2e3f4a5-b6c7-8901-2345-6789abcdef15', 1, 'Хороший ноутбук, но заряд держит не очень долго.', 'b2f8c7d4-1a3e-5b9c-6d2a-7e4f39a8c5d1', '550e8400-e29b-41d4-a716-446655440021'),
    ('e3f4a5b6-c7d8-9012-3456-789abcdef126', 1, 'Качество ткани не соответствует ожиданиям.', '5b2d9c7e-1a4f-3c8d-6b2f-7e39a4c8d1a5', '550e8400-e29b-41d4-a716-446655440028'),
    ('f4a5b6c7-d8e9-0123-4567-89abcdef1237', 1, 'Отличная книга, очень понравилась сюжетная линия.', 'a5d3f7b2-6e8c-4c1a-9d72-bf4e39a8c6e1', '550e8400-e29b-41d4-a716-446655440033'),
    ('a5b6c7d8-e9f0-1234-5678-9abcdef12348', 1, 'Шлем оказался не таким прочным, как заявлено.', '3e8c7d5b-1a4f-2d9c-6b2a-7f39e4c8d1a5', '550e8400-e29b-41d4-a716-446655440039'),
    ('c1a2b3d4-e5f6-4789-9123-456789abcde9', 2, 'Отличный смартфон, работает быстро!', 'a5d3f7b2-6e8c-4c1a-9d72-bf4e39a8c6e1', '550e8400-e29b-41d4-a716-446655440013'),
    ('d2e3f4a5-b6c7-8901-2345-6789abcdef19', 2, 'Хороший ноутбук, но заряд держит не очень долго.', 'b2f8c7d4-1a3e-5b9c-6d2a-7e4f39a8c5d1', '550e8400-e29b-41d4-a716-446655440021'),
    ('e3f4a5b6-c7d8-9012-3456-789abcdef120', 2, 'Качество ткани не соответствует ожиданиям.', '5b2d9c7e-1a4f-3c8d-6b2f-7e39a4c8d1a5', '550e8400-e29b-41d4-a716-446655440028'),
    ('f4a5b6c7-d8e9-0123-4567-89abcdef1239', 2, 'Отличная книга, очень понравилась сюжетная линия.', 'a5d3f7b2-6e8c-4c1a-9d72-bf4e39a8c6e1', '550e8400-e29b-41d4-a716-446655440033'),
    ('a5b6c7d8-e9f0-1234-5678-9abcdef12310', 2, 'Шлем оказался не таким прочным, как заявлено.', '3e8c7d5b-1a4f-2d9c-6b2a-7f39e4c8d1a5', '550e8400-e29b-41d4-a716-446655440039'),
    ('c1a2b3d4-e5f6-4789-9123-456789abcd23', 3, 'Отличный смартфон, работает быстро!', 'a5d3f7b2-6e8c-4c1a-9d72-bf4e39a8c6e1', '550e8400-e29b-41d4-a716-446655440013'),
    ('d2e3f4a5-b6c7-8901-2345-6789abcdef87', 3, 'Хороший ноутбук, но заряд держит не очень долго.', 'b2f8c7d4-1a3e-5b9c-6d2a-7e4f39a8c5d1', '550e8400-e29b-41d4-a716-446655440021'),
    ('e3f4a5b6-c7d8-9012-3456-789abcdef162', 3, 'Качество ткани не соответствует ожиданиям.', '5b2d9c7e-1a4f-3c8d-6b2f-7e39a4c8d1a5', '550e8400-e29b-41d4-a716-446655440028'),
    ('f4a5b6c7-d8e9-0123-4567-89abcdef1221', 3, 'Отличная книга, очень понравилась сюжетная линия.', 'a5d3f7b2-6e8c-4c1a-9d72-bf4e39a8c6e1', '550e8400-e29b-41d4-a716-446655440033'),
    ('a5b6c7d8-e9f0-1234-5678-9abcdef12309', 3, 'Шлем оказался не таким прочным, как заявлено.', '3e8c7d5b-1a4f-2d9c-6b2a-7f39e4c8d1a5', '550e8400-e29b-41d4-a716-446655440039'),
    ('c1a2b3d4-e5f6-4789-9123-456789abcd34', 4, 'Отличный смартфон, работает быстро!', 'a5d3f7b2-6e8c-4c1a-9d72-bf4e39a8c6e1', '550e8400-e29b-41d4-a716-446655440013'),
    ('d2e3f4a5-b6c7-8901-2345-6789abcdef45', 4, 'Хороший ноутбук, но заряд держит не очень долго.', 'b2f8c7d4-1a3e-5b9c-6d2a-7e4f39a8c5d1', '550e8400-e29b-41d4-a716-446655440021'),
    ('e3f4a5b6-c7d8-9012-3456-789abcdef234', 4, 'Качество ткани не соответствует ожиданиям.', '5b2d9c7e-1a4f-3c8d-6b2f-7e39a4c8d1a5', '550e8400-e29b-41d4-a716-446655440028'),
    ('f4a5b6c7-d8e9-0123-4567-89abcdef12cd', 4, 'Отличная книга, очень понравилась сюжетная линия.', 'a5d3f7b2-6e8c-4c1a-9d72-bf4e39a8c6e1', '550e8400-e29b-41d4-a716-446655440033'),
    ('a5b6c7d8-e9f0-1234-5678-9abcdef123ab', 4, 'Шлем оказался не таким прочным, как заявлено.', '3e8c7d5b-1a4f-2d9c-6b2a-7f39e4c8d1a5', '550e8400-e29b-41d4-a716-446655440039'),
    ('c1a2b3d4-e5f6-4789-9123-456789abcd56', 5, 'Отличный смартфон, работает быстро!', 'a5d3f7b2-6e8c-4c1a-9d72-bf4e39a8c6e1', '550e8400-e29b-41d4-a716-446655440013'),
    ('d2e3f4a5-b6c7-8901-2345-6789abcdef23', 5, 'Хороший ноутбук, но заряд держит не очень долго.', 'b2f8c7d4-1a3e-5b9c-6d2a-7e4f39a8c5d1', '550e8400-e29b-41d4-a716-446655440021'),
    ('e3f4a5b6-c7d8-9012-3456-789abcdef134', 5, 'Качество ткани не соответствует ожиданиям.', '5b2d9c7e-1a4f-3c8d-6b2f-7e39a4c8d1a5', '550e8400-e29b-41d4-a716-446655440028'),
    ('f4a5b6c7-d8e9-0123-4567-89abcdef1223', 5, 'Отличная книга, очень понравилась сюжетная линия.', 'a5d3f7b2-6e8c-4c1a-9d72-bf4e39a8c6e1', '550e8400-e29b-41d4-a716-446655440033'),
    ('a5b6c7d8-e9f0-1234-5678-9abcdef12323', 5, 'Шлем оказался не таким прочным, как заявлено.', '3e8c7d5b-1a4f-2d9c-6b2a-7f39e4c8d1a5', '550e8400-e29b-41d4-a716-446655440039');


CREATE TABLE IF NOT EXISTS review_1_star (
    CHECK (rating = 1)
) INHERITS (review);

CREATE TABLE IF NOT EXISTS review_2_star (
    CHECK (rating = 2)
) INHERITS (review);

CREATE TABLE IF NOT EXISTS review_3_star (
    CHECK (rating = 3)
) INHERITS (review);

CREATE TABLE IF NOT EXISTS review_4_star (
    CHECK (rating = 4)
) INHERITS (review);

CREATE TABLE IF NOT EXISTS review_5_star (
    CHECK (rating = 5)
) INHERITS (review);

CREATE FUNCTION review_insert_trigger() RETURNS trigger AS $$
BEGIN
    CASE NEW.rating
        WHEN 1 THEN INSERT INTO review_1_star VALUES (NEW.*);
        WHEN 2 THEN INSERT INTO review_2_star VALUES (NEW.*);
        WHEN 3 THEN INSERT INTO review_3_star VALUES (NEW.*);
        WHEN 4 THEN INSERT INTO review_4_star VALUES (NEW.*);
        WHEN 5 THEN INSERT INTO review_5_star VALUES (NEW.*);
        ELSE RAISE EXCEPTION 'Invalid rating: %', NEW.rating;
    END CASE;
    RETURN NULL;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER insert_review_trigger
BEFORE INSERT ON review
FOR EACH ROW EXECUTE FUNCTION review_insert_trigger();

WITH delete_row AS (
    DELETE FROM ONLY review WHERE rating = 1 RETURNING *
) INSERT INTO review_1_star SELECT * FROM delete_row;

WITH delete_row AS (
    DELETE FROM ONLY review WHERE rating = 2 RETURNING *
) INSERT INTO review_2_star SELECT * FROM delete_row;

WITH delete_row AS (
    DELETE FROM ONLY review WHERE rating = 3 RETURNING *
) INSERT INTO review_3_star SELECT * FROM delete_row;

WITH delete_row AS (
    DELETE FROM ONLY review WHERE rating = 4 RETURNING *
) INSERT INTO review_4_star SELECT * FROM delete_row;

WITH delete_row AS (
    DELETE FROM ONLY review WHERE rating = 5 RETURNING *
) INSERT INTO review_5_star SELECT * FROM delete_row;

INSERT INTO review (id, rating, text, user_id, product_id) VALUES 
    ('c1a2b3d4-e5f6-4789-9123-456789abcd78', 5, 'TEST DATA', 'a5d3f7b2-6e8c-4c1a-9d72-bf4e39a8c6e1', '550e8400-e29b-41d4-a716-446655440013');