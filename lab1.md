# Лабораторная работа 1. Проектрирование арзитектуры БД

РАБОТУ ВЫПОЛНИЛ СТУДЕНТ ГРУППЫ: М3210 Вартанян Леонтий Николаевич

## Условие лабораторной
### Задачи
    1. Провести анализ функционала сайта или портала в выбранной предметной области с
    позиции работы с данными, выделить сущности, их атрибуты и связи между сущностями.
    2. Спроектировать архитектуру БД для выбранной темы в виде модели сущность-связь
    (ERM) в нотации Мартина (Crow's Foot, «воронья лапка»).
    3. Преобразовать ERM в физическое представление (PDM) путём добавления нужных
    соединительных таблиц и внешних ключей – столбцов в существующие таблицы.
    4. Проверить, что модель находится минимум в третьей нормальной форме (3НФ).

### Порядок выполнения работы
    1. Выбрать один из предложенных ниже вариантов предметных областей или согласовать с преподавателем другой вариант.
    2. Провести анализ функционала сайта или портала в выбранной предметной области с
    позиции работы с данными, выделить сущности, их атрибуты и связи.
    3. Спроектировать архитектуру БД для выбранной темы в виде ERM в нотации Мартина.
    4. Преобразовать ERM в PDM, указать правила, которые использовались при
    преобразовании (для связей один-ко-многим, многие-ко-многим).
    5. Предоставить отчёт, включить в него следующие данные:
        • краткое описание предметной области и портала, в том числе пояснение,
        охватывает ли моделирование все данные или только те, которые относятся к
        некоторым бизнес-процессам (указать к каким);
        • ERM в нотации Мартина, PDM, процесс преобразования;
        • обоснование нахождения модели данных в 3НФ (или выше по желанию).

## Выполнение

### Тема: Поиск товаров на Яндекс-Маркет

### Предметная область

Дальнейший анализ предметоной области относится только к поиску и выбору товара на маркетплейсе. Опускает области: доставки, ранжирования товаров, подсказок для более быстрого поиска товара, оплаты, добавления товаров в корзину и другие функции маркетплейса.

#### Предметная область поиска/выбора товаров на маркетплейсе состоит из нескольких этапов:
1) Создание профиля пользователя
2) Выбор искомой категории товаров (Например: спорт-товары)
3) Уточнение категории с помощью подкатегории (Например: спорт-товары->автогонки)
4) Выбор подходящего товара (Например: основываясь на цене и названии)
5) Анализ отзывов для товара (Например: читаем, что какой-то цвет брать плохо)
6) Анализов рейтинга продавца (Например: смотрим количество выполненных доставок)
7) Создание заказа (Например: заказ из 3 товаров)

#### Исходя из описанных выше этапов можно выделить следующие сущности в системе:
1) Пользователь
2) Категория
3) Продукт (товар)
4) Отзыв
5) Заказ
6) Продавец

#### Далее стоит выделить таблицы и атрибуты, которые позволят реализовать сущности
1) Пользователь (user)
    - id
    - name
    - email
2) Категория (category)
    - id
    - name
3) Продукт (product)
    - id
    - name
    - description
    - price
4) Отзыв (review)
    - id
    - rating
    - text
5) Заказ (order)
    - id 
    - order_date
    - price
    - status
6) Продавец (seller)
    - id
    - name
    - rating

#### На основании этих данных построит ERM диаграмму в нотации Мартина
![Получившаяся ERM диаграмма](/images/erm1.png)

#### На основании предыдущего пункта построит PDM диаграмму
Заметим, что в нашем ERM есть связь многие ко многим и внешние ключи. 

Тогда подготовим более конкретное описание полей для каждой таблицы:

1) Пользователь (user)
    - id
    - name
    - email
2) Категория (category)
    - id
    - name
    - parent_category_id FOREIGN KEY FOR category.id (ONE TO ONE)
3) Продукт (product)
    - id
    - name
    - description
    - price
    - category_id FOREIGN KEY FOR category.id (ONE TO MANY)
    - seller_id FOREIGN KEY FOR seller.id (ONE TO MANY)
4) Отзыв (review)
    - id
    - rating
    - text
    - user_id FOREIGN KEY FOR user.id ()
    - product_id FOREIGN KEY FOR product.id (ONE TO MANY)
5) Заказ (order)
    - id 
    - order_date
    - price
    - status
    - user_id FOREIGN KEY FOR user.id (ONE TO MANY)
    - product_id FOREIGN KEY FOR product.id (MANY TO MANY)
6) Продавец (seller)
    - id
    - name
    - rating
    - product_id FOREIGN KEY FOR product.id (ONE TO MANY)

Чтобы избавиться от связей многие ко многим перейдем к использованию соединительных таблиц для ORDER-PRODUCT. 

Тогда создадим дополнительную таблицу: ***order_product***
* order_product
    - order_id FOREIGN KEY FOR order.id
    - product_id FOREIGN KEY FOR product.id

Тогда таблицы ***order*** и ***product*** примут вид:
1) Заказ (order)
    - id
    - order_date
    - price
    - status 
    - user_id FOREIGN KEY FOR user.od (ONE TO MANY)
2) Продукт (product)
    - id
    - name
    - description
    - price
    - category_id FOREIGN KEY FOR category.id (ONE TO MANY)
    - seller_id FOREIGN KEY FOR seller.id (ONE TO MANY)

![Полученная PDM диаграмма](/images/prdm1.png)

#### Докажем, что таблица находится в 3 нормальной форме
1) Вспомнин критерии 3 нормальной формы
    - Таблица находится во второй нормальной форме
        * Все атрибуты содержат атомарные значения (нет повторяющих)
        * Все атрибуты полностью зависят от первичного ключа
    - Таблица не имеет транзитивных зависимостей
2) Если каждая таблица схемы находится в 3НФ, то и вся схема находится в 3НФ
3) Для каждой таблицы докажем, что она находится в 3НФ
4) Таблица пользователя (user)
    - Как можно увидеть все атрибуты содержат атомарные значения
    - name и email зависят только от id => все атрибуты зависят от первичного ключа
    - Транзитивные зависимости отсутсвуют
5) Таблица отзывы (review)
    - Как можно увидеть все атрибуты содержат атомарные значения
    - Каждый атрибут зависит только от id (первичного ключа)
    - Транзитивные зависимости отсутсвуют
6) Таблица заказов (order)
    - Как можно увидеть все атрибуты содержат атомарные значения
    - Каждый атрибут зависит только от id (первичного ключа)
    - Транзитивные зависимости отсутсвуют
7) Таблица товаров (product)
    - Как можно увидеть все атрибуты содержат атомарные значения
    - Каждый атрибут зависит только от id (первичного ключа)
    - Транзитивные зависимости отсутсвуют
8) Таблица продавцов (seller)
    - Как можно увидеть все атрибуты содержат атомарные значения
    - Каждый атрибут зависит только от id (первичного ключа)
    - Транзитивные зависимости отсутсвуют
9) Таблица категорий (category)
    - Как можно увидеть все атрибуты содержат атомарные значения
    - Каждый атрибут зависит только от id (первичного ключа)
    - Транзитивные зависимости отсутсвуют
10) Связывающая таблица
    - Как можно увидеть все атрибуты содержат атомарные значения
    - Каждый атрибут зависит только от id (первичного ключа)
    - Транзитивные зависимости отсутсвуют
