# Лабораторная работа 3. Создание представления и индексов в PostgreSQL

РАБОТУ ВЫПОЛНИЛ СТУДЕНТ ГРУППЫ: М3210 Вартанян Леонтий Николаевич

## Условие лабораторной
### Задачи
    Создать представление и индексы к нескольким таблицам (минимум к двум).

    Требования к представлению:
        1. Должны быть задействованы минимум 2 таблицы.
        2. Должно быть задействовано минимум 4 поля.

    Требования к индексу:
        1. Должны использоваться минимум 2 поля для создания    индекса.
        2. Должно быть создано минимум 2 индекса к разным таблицам.


### Порядок выполнения работы

## Выполнение

### Тема: Поиск товаров на Яндекс-Маркет

### Создание представления (VIEW)
В представлении будем использовать таблицы `order`, `users`, `product` и `order_product`. Само представление будет связывать
данные пользователя с информацией о заканных им продуктах.

```sql
CREATE VIEW UserOrdersView AS
SELECT 
    u.name AS user_name,
    o.date AS order_date,
    p.name AS product_name,
    p.price AS product_price
FROM orders o
JOIN users u ON o.user_id = u.id
JOIN order_product op ON o.id = op.order_id
JOIN product p ON op.product_id = p.id;
```

### Создание индекса (INDEX)
Так как индексы должны использоваться для популярных (частых) запросов. То создадим их для двух сценариев.
1) Пользователь хочет понять какие ему принадлежат заказы
2) Пользователь пытается выбрать все товары категории

```sql
-- для более быстрого поиска по заказам пользователя --
CREATE INDEX idx_order_user_id ON orders (user_id);

-- для более быстрого поиска товаров по определенной категории --
CREATE INDEX idx_product_category_id ON product (category_id);
```

Для сранения производительности воспользуемся `EXPLAIN ANALYZE`. В нашем случае вместо индекса в первом случае будет использоваться SeqScan из-за мвлого количества строк в таблице. 

```sql
EXPLAIN ANALYZE SELECT * FROM orders WHERE user_id='a5d3f7b2-6e8c-4c1a-9d72-bf4e39a8c6e1';
EXPLAIN ANALYZE SELECT * FROM orders WHERE status='done';
```