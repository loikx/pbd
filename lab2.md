# Лабораторная работа 2. Создание таблиц в PostgreSQL

РАБОТУ ВЫПОЛНИЛ СТУДЕНТ ГРУППЫ: М3210 Вартанян Леонтий Николаевич

## Условие лабораторной
### Задачи
    1.  На основе спроектированной PDM из лабораторной 1 создать таблицы и  наложить необходимые ограничения (на уникальность, на диапазон значений).
    2. Заполнить таблицы данными, по 5–10 записей в основных таблицах.

### Порядок выполнения работы
    1. Скачайте и установите PostgreSQL (также установите pgAdmin, pgBouncer)
    2. Выполнение: 
        2.1. Создать схему и таблицы, принадлежащие этой схеме. Документация
        2.2. Заполнить созданные таблицы данными (минимум по 5–10 записей в основных таблицах). Часть таблиц должна быть заполнена SQL-запросами, другая часть таблиц должна быть заполнена из .csv файлов.
    3. Предоставить отчёт, включив в него код для создания и заполнения таблиц.

## Выполнение

### Тема: Поиск товаров на Яндекс-Маркет

### Схема данных PDM из Лабораторной №1
![Полученная PDM диаграмма](/images/prdm1.png)

### Код для создания таблиц
```sql
CREATE TYPE enum_status AS ENUM ('accept', 'deliver', 'done');


CREATE TABLE IF NOT EXISTS users (
    id UUID NOT NULL PRIMARY KEY,
    name TEXT NOT NULL CHECK ( length(name) <= 255 ),
    email TEXT NOT NULL CHECK ( length(email) <= 255 )
);

CREATE TABLE IF NOT EXISTS category (
    id UUID NOT NULL PRIMARY KEY,
    name TEXT NOT NULL CHECK ( length(name) <= 255 ),
    parent_category_id UUID REFERENCES category(id)
);

CREATE TABLE IF NOT EXISTS seller (
    id UUID NOT NULL PRIMARY KEY,
    name TEXT NOT NULL CHECK ( length(name) <= 255 ),
    rating INT NOT NULL CHECK ( rating >= 1 and rating <= 5 )
);


CREATE TABLE IF NOT EXISTS orders (
    id UUID NOT NULL PRIMARY KEY,
    date DATE NOT NULL,
    price MONEY NOT NULL CHECK ( price > MONEY(0) ),
    status enum_status NOT NULL,
    user_id UUID NOT NULL REFERENCES users(id)
);

CREATE TABLE IF NOT EXISTS product (
    id UUID NOT NULL PRIMARY KEY,
    name TEXT NOT NULL CHECK ( length(name) <= 255 ),
    description TEXT NOT NULL CHECK ( length(description) <= 10000 ),
    price MONEY NOT NULL CHECK ( price > MONEY(0) ),
    category_id UUID NOT NULL REFERENCES category(id),
    seller_id UUID NOT NULL REFERENCES seller(id)
);

CREATE TABLE IF NOT EXISTS review (
    id UUID NOT NULL PRIMARY KEY,
    rating INT NOT NULL CHECK ( rating >= 1 and rating <= 5 ),
    text TEXT NOT NULL CHECK ( length(text) <= 10000 ),
    user_id UUID NOT NULL REFERENCES users(id),
    product_id UUID NOT NULL REFERENCES product(id)
);

CREATE TABLE IF NOT EXISTS order_product (
    order_id UUID NOT NULL REFERENCES orders(id),
    product_id UUID NOT NULL REFERENCES product(id)
);
```

### Код для заполнения данных
```sql
INSERT INTO users (id, name, email) VALUES 
    ('a5d3f7b2-6e8c-4c1a-9d72-bf4e39a8c6e1', 'maksim', 'maksim@mail.ru'),
    ('e2b8d4f1-5a7c-4d39-8f6e-3c2a7b1d9f84', 'dmitriy', 'dmitriy@mail.ru'),
    ('9c3a5e7d-8b24-4f12-a6d1-7e8f4b2c39a5', 'egor', 'egor@mail.ru'),
    ('6d7e1a3c-9b25-4f8c-2a4d-5b39f7e8c1a2', 'vasilisa', 'vasilisa@mail.ru'),
    ('b2f8c7d4-1a3e-5b9c-6d2a-7e4f39a8c5d1', 'maria', 'maria@mail.ru'),
    ('d4b2f8a7-3c1e-5d9c-6a2b-7f4e39c8d1a5', 'natalya', 'natalya@mail.ru'),
    ('3e8c7d5b-1a4f-2d9c-6b2a-7f39e4c8d1a5', 'sergey', 'sergey@mail.ru'),
    ('2a4d9c7e-1b5f-3c8d-6b2f-7e39a4c8d1a5', 'sonya', 'sonya@mail.ru'),
    ('7f2d8c4b-1a5e-3d9c-6b2f-7e39a4c8d1a5', 'pavel', 'pavel@mail.ru'),
    ('5b2d9c7e-1a4f-3c8d-6b2f-7e39a4c8d1a5', 'olga', 'olga@mail.ru');


COPY seller FROM '/usr/seller.csv' DELIMITER ',' CSV HEADER;

INSERT INTO category (id, name) VALUES
    ('550e8400-e29b-41d4-a716-446655440000', 'Электроника'),
    ('550e8400-e29b-41d4-a716-446655440001', 'Одежда'),
    ('550e8400-e29b-41d4-a716-446655440002', 'Книги'),
    ('550e8400-e29b-41d4-a716-446655440003', 'Мебель'),
    ('550e8400-e29b-41d4-a716-446655440004', 'Спорт');

INSERT INTO category (id, name, parent_category_id) VALUES
    ('550e8400-e29b-41d4-a716-446655440005', 'Смартфоны', '550e8400-e29b-41d4-a716-446655440000'),
    ('550e8400-e29b-41d4-a716-446655440006', 'Ноутбуки', '550e8400-e29b-41d4-a716-446655440000'), 
    ('550e8400-e29b-41d4-a716-446655440007', 'Мужская одежда', '550e8400-e29b-41d4-a716-446655440001'),
    ('550e8400-e29b-41d4-a716-446655440008', 'Женская одежда', '550e8400-e29b-41d4-a716-446655440001'),
    ('550e8400-e29b-41d4-a716-446655440009', 'Фантастика', '550e8400-e29b-41d4-a716-446655440002'),
    ('550e8400-e29b-41d4-a716-446655440010', 'Велоспорт', '550e8400-e29b-41d4-a716-446655440004');

INSERT INTO product (id, name, description, price, category_id, seller_id) VALUES
    ('550e8400-e29b-41d4-a716-446655440011', 'Xiaomi Redmi Note 12', 'Смартфон с AMOLED дисплеем и мощной батареей', 19999, '550e8400-e29b-41d4-a716-446655440005', '5de4c2a9-17b4-4b68-b5a1-9e2e1bfb249d'),
    ('550e8400-e29b-41d4-a716-446655440012', 'iPhone 14', 'Флагманский смартфон Apple с A15 Bionic', 79999, '550e8400-e29b-41d4-a716-446655440005', '8a1c5e7d-94f3-4e12-81d4-6b8e4a7c5f3e'),
    ('550e8400-e29b-41d4-a716-446655440013', 'Samsung Galaxy S23', 'Флагман от Samsung с лучшими камерами', 89999, '550e8400-e29b-41d4-a716-446655440005', 'b3c2e17d-48a5-4a9b-87e4-3f2d6a1b8c97'),
    ('550e8400-e29b-41d4-a716-446655440014', 'Google Pixel 7', 'Чистый Android и мощные AI-функции', 64999, '550e8400-e29b-41d4-a716-446655440005', '7f6c9d81-8b27-4b23-9e49-2a8a6eaf9b99'),
    ('550e8400-e29b-41d4-a716-446655440015', 'OnePlus 11', 'Флагманский смартфон с быстрой зарядкой', 69999, '550e8400-e29b-41d4-a716-446655440005', '2f7b3a94-68e1-45c2-97f8-5bcd8e7a2d14'),
    ('550e8400-e29b-41d4-a716-446655440016', 'Honor v54', 'Отличный смартфом с красивым корпусом', 120999, '550e8400-e29b-41d4-a716-446655440005', '4f7c5a1d-3b2e-4c8a-8d09-99f7b7c2145a'),
    ('550e8400-e29b-41d4-a716-446655440017', 'Huawei Nova', 'Первый смартфон с 8 камерами!', 12345, '550e8400-e29b-41d4-a716-446655440005', '4f7c5a1d-3b2e-4c8a-8d09-99f7b7c2145a'),

    ('550e8400-e29b-41d4-a716-446655440018', 'MacBook Air M2', 'Легкий и мощный ноутбук Apple', 119999, '550e8400-e29b-41d4-a716-446655440006', '8a1c5e7d-94f3-4e12-81d4-6b8e4a7c5f3e'),
    ('550e8400-e29b-41d4-a716-446655440019', 'ASUS ROG Zephyrus', 'Игровой ноутбук с RTX 3080', 159999, '550e8400-e29b-41d4-a716-446655440006', 'b3c2e17d-48a5-4a9b-87e4-3f2d6a1b8c97'),
    ('550e8400-e29b-41d4-a716-446655440020', 'Dell XPS 15', 'Премиальный ультрабук для работы', 139999, '550e8400-e29b-41d4-a716-446655440006', '7f6c9d81-8b27-4b23-9e49-2a8a6eaf9b99'),
    ('550e8400-e29b-41d4-a716-446655440021', 'Lenovo Legion 5', 'Игровой ноутбук с AMD Ryzen', 99999, '550e8400-e29b-41d4-a716-446655440006', '2f7b3a94-68e1-45c2-97f8-5bcd8e7a2d14'),
    ('550e8400-e29b-41d4-a716-446655440022', 'XIAOMI Spectre x360', 'Трансформируемый ноутбук с OLED дисплеем', 129999, '550e8400-e29b-41d4-a716-446655440006', '5de4c2a9-17b4-4b68-b5a1-9e2e1bfb249d'),

    ('550e8400-e29b-41d4-a716-446655440023', 'Джинсы Levis', 'Классические мужские джинсы', 4999, '550e8400-e29b-41d4-a716-446655440007', 'd93b5f6e-01b2-4a8c-92a4-1b5c8e7fda37'),
    ('550e8400-e29b-41d4-a716-446655440024', 'Кожаная куртка', 'Стильная кожаная куртка для мужчин', 15999, '550e8400-e29b-41d4-a716-446655440007', 'd93b5f6e-01b2-4a8c-92a4-1b5c8e7fda37'),
    ('550e8400-e29b-41d4-a716-446655440025', 'Футболка Nike', 'Спортивная футболка с логотипом', 2499, '550e8400-e29b-41d4-a716-446655440007', '7f6c9d81-8b27-4b23-9e49-2a8a6eaf9b99'),
    ('550e8400-e29b-41d4-a716-446655440026', 'Пуховик Columbia', 'Зимний теплый пуховик', 12999, '550e8400-e29b-41d4-a716-446655440007', 'b3c2e17d-48a5-4a9b-87e4-3f2d6a1b8c97'),
    ('550e8400-e29b-41d4-a716-446655440027', 'Спортивные штаны Adidas', 'Удобные спортивные брюки', 3999, '550e8400-e29b-41d4-a716-446655440007', 'd93b5f6e-01b2-4a8c-92a4-1b5c8e7fda37'),

    ('550e8400-e29b-41d4-a716-446655440028', 'Джинсы Zara', 'Классические мужские джинсы', 1234, '550e8400-e29b-41d4-a716-446655440008', 'd93b5f6e-01b2-4a8c-92a4-1b5c8e7fda37'),
    ('550e8400-e29b-41d4-a716-446655440029', 'Кожаная куртка Lime', 'Стильная кожаная куртка для мужчин', 2345, '550e8400-e29b-41d4-a716-446655440008', 'd93b5f6e-01b2-4a8c-92a4-1b5c8e7fda37'),
    ('550e8400-e29b-41d4-a716-446655440030', 'Футболка Adidas', 'Спортивная футболка с логотипом', 3456, '550e8400-e29b-41d4-a716-446655440008', '7f6c9d81-8b27-4b23-9e49-2a8a6eaf9b99'),
    ('550e8400-e29b-41d4-a716-446655440031', 'Пуховик TNF', 'Зимний теплый пуховик', 4567, '550e8400-e29b-41d4-a716-446655440008', 'b3c2e17d-48a5-4a9b-87e4-3f2d6a1b8c97'),
    ('550e8400-e29b-41d4-a716-446655440032', 'Спортивные штаны Nike', 'Удобные спортивные брюки', 5678, '550e8400-e29b-41d4-a716-446655440008', 'd93b5f6e-01b2-4a8c-92a4-1b5c8e7fda37'),

    ('550e8400-e29b-41d4-a716-446655440033', 'Дюна', 'Легендарный роман Фрэнка Герберта', 999, '550e8400-e29b-41d4-a716-446655440009', 'e8a2a6b9-53e5-4f89-85ad-bcd39a6f1e3c'),
    ('550e8400-e29b-41d4-a716-446655440034', '451 градус по Фаренгейту', 'Антиутопия Рэя Брэдбери', 799, '550e8400-e29b-41d4-a716-446655440009', 'e8a2a6b9-53e5-4f89-85ad-bcd39a6f1e3c'),
    ('550e8400-e29b-41d4-a716-446655440035', 'Марсианин', 'Роман о выживании на Марсе', 899, '550e8400-e29b-41d4-a716-446655440009', '7f6c9d81-8b27-4b23-9e49-2a8a6eaf9b99'),
    ('550e8400-e29b-41d4-a716-446655440036', 'Гиперион', 'Первая книга цикла Дэна Симмонса', 1099, '550e8400-e29b-41d4-a716-446655440009', 'e5a8b4c7-12f3-4d5a-8c9e-7b6d2a4f3e81'),
    ('550e8400-e29b-41d4-a716-446655440037', 'Война миров', 'Классика научной фантастики', 699, '550e8400-e29b-41d4-a716-446655440009', 'b3c2e17d-48a5-4a9b-87e4-3f2d6a1b8c97'),

    ('550e8400-e29b-41d4-a716-446655440038', 'Colnago V12', 'Лучший бренд шоссейных велосипедов', 1234567, '550e8400-e29b-41d4-a716-446655440010', '9d4e2a6b-7f38-42c1-8a5e-3b97c5d8e4f2'),
    ('550e8400-e29b-41d4-a716-446655440039', 'Met', 'Шлем - часть вашей безопасности', 8765, '550e8400-e29b-41d4-a716-446655440010', '9d4e2a6b-7f38-42c1-8a5e-3b97c5d8e4f2');
    
INSERT INTO review (id, rating, text, user_id, product_id) VALUES 
    ('c1a2b3d4-e5f6-4789-9123-456789abcdef', 5, 'Отличный смартфон, работает быстро!', 'a5d3f7b2-6e8c-4c1a-9d72-bf4e39a8c6e1', '550e8400-e29b-41d4-a716-446655440013'),
    ('d2e3f4a5-b6c7-8901-2345-6789abcdef12', 4, 'Хороший ноутбук, но заряд держит не очень долго.', 'b2f8c7d4-1a3e-5b9c-6d2a-7e4f39a8c5d1', '550e8400-e29b-41d4-a716-446655440021'),
    ('e3f4a5b6-c7d8-9012-3456-789abcdef123', 3, 'Качество ткани не соответствует ожиданиям.', '5b2d9c7e-1a4f-3c8d-6b2f-7e39a4c8d1a5', '550e8400-e29b-41d4-a716-446655440028'),
    ('f4a5b6c7-d8e9-0123-4567-89abcdef1234', 5, 'Отличная книга, очень понравилась сюжетная линия.', 'a5d3f7b2-6e8c-4c1a-9d72-bf4e39a8c6e1', '550e8400-e29b-41d4-a716-446655440033'),
    ('a5b6c7d8-e9f0-1234-5678-9abcdef12345', 2, 'Шлем оказался не таким прочным, как заявлено.', '3e8c7d5b-1a4f-2d9c-6b2a-7f39e4c8d1a5', '550e8400-e29b-41d4-a716-446655440039');

INSERT INTO orders (id, date, price, status, user_id) VALUES
    ('550e8400-e29b-41d4-a716-446655440040', '2024-02-10', 19999, 'accept', 'a5d3f7b2-6e8c-4c1a-9d72-bf4e39a8c6e1'),
    ('550e8400-e29b-41d4-a716-446655440041', '2024-02-09', 45999, 'done', 'e2b8d4f1-5a7c-4d39-8f6e-3c2a7b1d9f84'),
    ('550e8400-e29b-41d4-a716-446655440042', '2024-02-08', 9999, 'done', '9c3a5e7d-8b24-4f12-a6d1-7e8f4b2c39a5'),
    ('550e8400-e29b-41d4-a716-446655440043', '2024-02-07', 2499, 'deliver', '6d7e1a3c-9b25-4f8c-2a4d-5b39f7e8c1a2'),
    ('550e8400-e29b-41d4-a716-446655440044', '2024-02-06', 78999, 'done', 'b2f8c7d4-1a3e-5b9c-6d2a-7e4f39a8c5d1'),
    ('550e8400-e29b-41d4-a716-446655440045', '2024-02-05', 3199, 'deliver', 'd4b2f8a7-3c1e-5d9c-6a2b-7f4e39c8d1a5'),
    ('550e8400-e29b-41d4-a716-446655440046', '2024-02-04', 14999, 'accept', '3e8c7d5b-1a4f-2d9c-6b2a-7f39e4c8d1a5'),
    ('550e8400-e29b-41d4-a716-446655440047', '2024-02-16', 12399, 'deliver', '5b2d9c7e-1a4f-3c8d-6b2f-7e39a4c8d1a5');

INSERT INTO order_product (order_id, product_id) VALUES
    ('550e8400-e29b-41d4-a716-446655440040', '550e8400-e29b-41d4-a716-446655440013'),
    ('550e8400-e29b-41d4-a716-446655440040', '550e8400-e29b-41d4-a716-446655440033'), 
    ('550e8400-e29b-41d4-a716-446655440041', '550e8400-e29b-41d4-a716-446655440012'),
    ('550e8400-e29b-41d4-a716-446655440042', '550e8400-e29b-41d4-a716-446655440014'),
    ('550e8400-e29b-41d4-a716-446655440043', '550e8400-e29b-41d4-a716-446655440021'),
    ('550e8400-e29b-41d4-a716-446655440044', '550e8400-e29b-41d4-a716-446655440018'),
    ('550e8400-e29b-41d4-a716-446655440045', '550e8400-e29b-41d4-a716-446655440025'),
    ('550e8400-e29b-41d4-a716-446655440046', '550e8400-e29b-41d4-a716-446655440039'),
    ('550e8400-e29b-41d4-a716-446655440047', '550e8400-e29b-41d4-a716-446655440028');
```

### Данные файла seller.csv
```csv
id,name,rating
"4f7c5a1d-3b2e-4c8a-8d09-99f7b7c2145a","ИП МОИ ДЕВАЙСЫ",3
"d93b5f6e-01b2-4a8c-92a4-1b5c8e7fda37","ШТАНЫ И КУРТКИ",2
"e8a2a6b9-53e5-4f89-85ad-bcd39a6f1e3c","перепродажа ru",1
"7f6c9d81-8b27-4b23-9e49-2a8a6eaf9b99","маркет у дома",5
"5de4c2a9-17b4-4b68-b5a1-9e2e1bfb249d","Xiaomi",5
"8a1c5e7d-94f3-4e12-81d4-6b8e4a7c5f3e","Девайсы apple",3
"2f7b3a94-68e1-45c2-97f8-5bcd8e7a2d14","ИП УМНЫЙ ДОМ",5
"b3c2e17d-48a5-4a9b-87e4-3f2d6a1b8c97","ООО ПОКУПАЕМ ПРОДАЕМ",4
"e5a8b4c7-12f3-4d5a-8c9e-7b6d2a4f3e81","ФАБРИКА",5
"9d4e2a6b-7f38-42c1-8a5e-3b97c5d8e4f2","NAKAT",5
